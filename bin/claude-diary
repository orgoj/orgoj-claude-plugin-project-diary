#!/usr/bin/env node
/**
 * Claude Diary Wrapper - Cross-platform entry point
 * Detects platform and calls the appropriate mopc binary
 */

const fs = require('fs');
const path = require('path');
const { spawnSync } = require('child_process');

// Detect platform
const platformMap = {
  linux: 'linux',
  darwin: 'darwin',
  win32: 'windows'
};

const archMap = {
  x64: 'x64',
  arm64: 'arm64'
};

const os = platformMap[process.platform];
const arch = archMap[process.arch];

if (!os || !arch) {
  console.error(`Unsupported platform: ${process.platform} ${process.arch}`);
  process.exit(1);
}

const platform = `${os}-${arch}`;
const ext = os === 'windows' ? '.exe' : '';

// Paths
const pluginRoot = path.resolve(__dirname, '..');
const mopcBin = path.join(pluginRoot, 'zig-out', 'bin', platform, `mopc${ext}`);

// Check if binary exists
if (!fs.existsSync(mopcBin)) {
  console.error(`Error: mopc binary not found for platform ${platform}`);
  console.error(`Expected: ${mopcBin}`);
  process.exit(1);
}

// Call mopc wrapper with all arguments
const args = ['wrapper', ...process.argv.slice(2)];
const result = spawnSync(mopcBin, args, {
  stdio: 'inherit',
  cwd: process.cwd()
});

process.exit(result.status || 0);
